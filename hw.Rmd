---
title: "Homework"
author: "Yu-Min, Liao"
date: "12/12/2021"
output: html_notebook
runtime: shiny
---

#### 1. Preprocess data 
自政府資料開放平臺：https://data.gov.tw/dataset/12197 下載109年度交通事故資料合計共3個檔案（109年A1交通事故資料.csv、109年A2交通事故資料(109年1月-6月).csv、109年A2交通事故資料(109年7月-12月).csv。 
預先將檔案從中篩選出「新竹市」的交通事故、合併A2兩個檔案並僅留下經緯度。分別另存為兩個檔案：hsinchu_109_A1.csv、hsinchu_109_A2.csv。

#### 2. Install packages 
```{r echo = FALSE}
if(! require("rstudioapi")) install.packages("rstudioapi")
library(rstudioapi)

if(! require("ggplot2")) install.packages("ggplot2")
library(ggplot2)

if(! require("ggmap")) install.packages("ggmap")
library(ggmap)
```

#### 3. Read data
```{r}
A1<- read.csv("hsinchu_109_A1.csv", header = TRUE)
A2<- read.csv("hsinchu_109_A2.csv", header = TRUE)
```

#### 4. Make a Map (Hsinchu)
```{r echo = FALSE}
#Set API Key
ggmap::register_google(key = "AIzaSyBmGg9PMd0OZ8tHZdxvsPsIXp4W16fP1zA")
```

```{r}
#Get Hsinchu City's Map
map<- ggmap(get_googlemap(center = c(lon=120.9667, lat=24.8), 
                        zoom = 13, scale = 2,
                        maptype = "terrain",
                        color = "color",
                        extent = "device"))
```

```{r}
#Create color variable for graphing
col1 = "#b3cde0" 
```

#### 5. Create a map with all A1 accident locations plotted
```{r}
#Point Graph
map+
  geom_point(
    aes(x = longitude, y = latitude, color= col1),
    data= A1, 
    size= 0.5)+ 
  theme(legend.position = "bottom")
```

```{r}
#Spatical Heatmap
map+
  stat_density2d(
    aes(x = longitude, y = latitude, fill = ..level.., alpha= 0.05), 
    bins= 10, 
    data= A1, 
    geom= "polygon")
```

#### 6. Create a map with all A2 accident locations plotted
```{r}
#Point Graph
map+
  geom_point(
    aes(x = longitude, y = latitude, colour= col1), 
    data= A2, 
    alpha= 0.25, 
    size= 0.05)+ 
  theme(legend.position = "none")
```

```{r}
#Spatical Heatmap
map+
  stat_density2d(
    aes(x = longitude, y = latitude, fill = ..level.., alpha= 0.05),
    bins= 10, 
    data= A2, 
    geom= "polygon")
```

#### 7. Analysis and Conclusion
此次作業需分析政府公開資料集中的交通事故資料，找出事故熱區。
資料集選擇109年新竹市的A1(有死亡)、A2(僅受傷無死亡)之資料分析該年度新竹市的交通事故熱區，由於事故熱區資料多為經緯度資訊，若以地圖方式呈現會更加清楚，因此利用ggplot2做出spatical heatmap、point graph 以利分析。依上圖所示，易發生死亡車禍A1事故熱區主要集中在新竹市區火車站附近、其次是中華大學、牛埔附近、再者為通往南寮的路上。 A2車禍事故熱區也一樣是新竹市火車站附近最多，再者為光復路上老爺飯店附近，也可以明顯的看出新竹市主要幹道上，如光復路、寶山路皆是易發生車禍的事故熱區。
